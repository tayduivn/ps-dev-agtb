<project>
    <shortName>sugarcrm</shortName>
    <fullName>SugarCRM on FastStack</fullName>
    <version>@_SUGAR_VERSION</version>
    <installerFilename>${product_shortname}-PRO-${product_version}-${platform_name}-installer.${platform_exec_suffix}</installerFilename>
    <licenseFile>license.txt</licenseFile>
    <wrapLicenseFileText>1</wrapLicenseFileText>
    <leftImage>images/sugarleft.png</leftImage>
    <wmImage>images/wmImage.png</wmImage>
    <logoImage>images/sugarcrm_logo_transparent_200x36.gif</logoImage>
    <splashImage>images/sugarsplash.png</splashImage>
    <allowLanguageSelection>0</allowLanguageSelection>
    <outputDirectory>/home/build/sugarbuild-BitRock-@_SUGAR_VERSION/zip</outputDirectory>
    <projectSchemaVersion>1.2</projectSchemaVersion>
    <saveRelativePaths>1</saveRelativePaths>
    <startMenuGroupName>${product_fullname}</startMenuGroupName>
    <style>standard</style>
    <vendor>SugarCRM</vendor>
    <allowComponentSelection>1</allowComponentSelection>


    <preBuildActionList>	
		<setInstallerVariable name="product_fullname" value="SugarCRM on FastStack" >
			<ruleList>
				<platformTest type="linux" />
			</ruleList>	    
		</setInstallerVariable>	
		<setInstallerVariable name="product_fullname" value="SugarCRM on WAMPStack" >
			<ruleList>	
				<platformTest type="windows" />
			</ruleList>		
		</setInstallerVariable>	
		<setInstallerVariable name="product_fullname" value="SugarCRM on MAMPStack" >
			<ruleList>	
				<platformTest type="osx" />
			</ruleList>		
		</setInstallerVariable>	
		<setInstallerVariable name="product_fullname" value="SugarCRM on BitRock SAMPStack" >
		        <ruleEvaluationLogic>or</ruleEvaluationLogic>
		        <ruleList>	
				<platformTest type="solaris" />
			</ruleList>		
		</setInstallerVariable>	


        <!-- MySQL -->
        <setInstallerVariable name="component(mysql).parameter(mysql1).parameter(mysql_binary_directory).cliOptionShow" value="0" />      
        <setInstallerVariable name="component(mysql).parameter(mysql1).parameter(mysql_hostname).cliOptionShow" value="0" />

        <setInstallerVariable name="component(mysql).parameter(mysql_installtype).cliOptionShow" value="0" />
		<setInstallerVariable name="component(mysql).parameter(mysql_installtype_options).value" value="bundled" />
		<setInstallerVariable name="component(mysql).parameter(mysql_installtype).value" value="bundled" />
		<setInstallerVariable name="component(mysql).parameter(mysql_installtype).ask" value="no" />	

        <setInstallerVariable name="component(mysql).parameter(mysql2).parameter(mysql_root_password).cliOptionText" value="MySQL Server root password" />
        <setInstallerVariable name="component(mysql).parameter(mysql2).parameter(mysql_root_password).description" value="Root password" />

		<setInstallerVariable name="component(mysql).parameter(mysql1).title" value="DB Port" />
		<setInstallerVariable name="component(mysql).parameter(mysql1).description" value="MySQL database Port" />
		<setInstallerVariable name="component(mysql).parameter(mysql1).explanation" value="Please enter the port that the bundled MySQL database will use." />
        <setInstallerVariable name="component(mysql).parameter(mysql1).parameter(mysql_port).description" value="MySQL Server port" />

		<setInstallerVariable name="component(mysql).parameter(mysql_data).ask" value="no" />	
		<setInstallerVariable name="component(mysql).parameter(mysql_data).cliOptionShow" value="no" />	
		<setInstallerVariable name="component(mysql).parameter(mysql_data).parameter(mysql_db_name).ask" value="no" />
		<setInstallerVariable name="component(mysql).parameter(mysql_data).parameter(mysql_db_name).cliOptionShow" value="no" />
		<setInstallerVariable name="component(mysql).parameter(mysql_data).parameter(mysql_db_username).ask" value="no" />
		<setInstallerVariable name="component(mysql).parameter(mysql_data).parameter(mysql_db_username).cliOptionShow" value="no" />
		<setInstallerVariable name="component(mysql).parameter(mysql_data).parameter(mysql_db_password).ask" value="no" />
		<setInstallerVariable name="component(mysql).parameter(mysql_data).parameter(mysql_db_password).cliOptionShow" value="no" />

		<setInstallerVariable name="component(mysql).parameter(allow_empty_root_password).value" value="0"/>

        <!-- Apache -->
		<setInstallerVariable name="component(apache).parameter(apache_server_port).title" value="Web Server Port" />
        <setInstallerVariable name="component(apache).parameter(apache_server_port).description" value="Apache Web Server Port" />
		<setInstallerVariable name="component(apache).parameter(apache_server_port).explanation" value="Please enter the port that the bundled Apache Server will listen to by default." />
		<setInstallerVariable name="component(apache).parameter(apache_server_sslport).title" value="Web Server Port" />
        <setInstallerVariable name="component(apache).parameter(apache_server_sslport).description" value="SSL Port" />
		<setInstallerVariable name="component(apache).parameter(apache_server_sslport).explanation" value="Please enter the port that the bundled Apache Server will use for SSL access." />
		<setInstallerVariable name="component(apache).parameter(apache_server_domainname).title" value="Web Server Domain" />
        <setInstallerVariable name="component(apache).parameter(apache_server_domainname).description" value="Web Server domain" />
		<setInstallerVariable name="component(apache).parameter(apache_server_domainname).explanation" value="" />

        <!-- PHPMyAdmin -->
        <setInstallerVariable name="component(phpmyadmin).show" value="1" />
        <setInstallerVariable name="component(phpmyadmin).canBeEdited" value="1" />
        <setInstallerVariable name="component(phpmyadmin).description" value="phpMyAdmin" />
        <setInstallerVariable name="component(phpmyadmin).parameter(phpmyadmin_destination).value" value="htdocs" />
        <setInstallerVariable name="component(phpmyadmin).parameter(phpmyadmin_destination).default" value="htdocs" />

        <setInstallerVariable name="component(phpmyadmin).parameter(phpmyadmin_root).value" value="administrator" />
        <setInstallerVariable name="component(phpmyadmin).parameter(phpmyadmin_root).ask" value="no" /> 

		<setInstallerVariable name="component(phpmyadmin).parameter(phpmyadminpasswd).value" value="" />
		<setInstallerVariable name="component(phpmyadmin).parameter(phpmyadminpasswd).ask" value="yes" />
		<setInstallerVariable name="component(phpmyadmin).parameter(phpmyadminpasswd).title" value="phpMyAdmin Password" />
		<setInstallerVariable name="component(phpmyadmin).parameter(phpmyadminpasswd).description" value="Password" />
		<setInstallerVariable name="component(phpmyadmin).parameter(phpmyadminpasswd).explanation" value="Initial access password for the MySQL management tool phpMyAdmin. 
The username will be 'administrator'." />


    </preBuildActionList> 	


    <initializationActionList>
        <setInstallerVariable name="sugarinstall" value="spro" />
        <componentSelection>
            <deselect>iis</deselect>
<!--            <ruleList>	
                <platformTest type="unix" />                
            </ruleList>		-->
        </componentSelection>
        <componentSelection>
            <deselect>mssql</deselect>
<!--            <ruleList>	
                <platformTest type="unix" />                
            </ruleList>		-->
        </componentSelection>
    </initializationActionList> 


    <preInstallationActionList>
    </preInstallationActionList>
    
    
	<componentList>		
		<component>
			<name>default</name>
			<description>SugarCRM</description>
			<canBeEdited>0</canBeEdited>
			<detailedDescription>The SugarCRM main program files. This component is required and it will always be installed.</detailedDescription>
            <selected>1</selected>
			<show>1</show>
            <desktopShortcutList>
				<fileShortcut>
                    <comment>SugarCRMStack Installation Directory</comment>
                    <filePath>${installdir}/</filePath>
                    <icon>${installdir}/htdocs/sugar.gif</icon>
                    <name>SugarCRM</name>
                    <platforms>linux solaris-intel solaris-sparc</platforms>
                    <windowsIcon></windowsIcon>
                </fileShortcut>
            </desktopShortcutList>
            
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfilesunix</name>
                    <platforms>linux osx solaris-intel solaris-sparc</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>common</origin>
                        </distributionDirectory>
                        <distributionFile>
                            <origin>sugarctl.sh</origin>
                        </distributionFile>
                    </distributionFileList>
                    <actionList>
                        <changePermissions>
                            <files>${installdir}/sugarctl.sh</files>
                            <permissions>700</permissions>				
                        </changePermissions>					
                    </actionList>
                </folder>
	    
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <actionList>
                        <actionGroup>
							<actionList>
								<changePermissions>
									<files>*/cache*;*/data*;*/custom*;*/modules*;*/config.php</files>
									<permissions>777</permissions>
								</changePermissions>
							</actionList>
							<ruleList>
								<platformTest type="unix" />
							</ruleList>
						</actionGroup>
								
<!--						<substitute>
							<files>*/apachectl;*/conf/*.conf;*/build-defs.h;*/apxs;*/apr-config;*/apu-config;*/bin/envvars;*/bin/envvars-std;*/build/config*;lib/libapr*.la;*/pearcmd.php;*/pear.conf;*/build-defs.h;*/etc/php.ini;*/bin/pear;*/bin/phpize;*/bin/php-config;*/bin/php;*.la;*.mk;*/*.h</files>
							<substitutionList>
								<substitution>
									<pattern>@@BITROCK_PHP_ROOTDIR@@</pattern>
									<value>${installdir}/php</value>
								</substitution>
								<substitution>
									<pattern>@@BITROCK_APACHE_ROOTDIR@@</pattern>
									<value>${installdir}/apache2</value>
								</substitution>
								<substitution>
									<pattern>@@BITROCK_COMMON_ROOTDIR@@</pattern>
									<value>${installdir}/common</value>
								</substitution>
							</substitutionList>
							<ruleList>
								<platformTest type="unix" />
							</ruleList>
						</substitute>
-->
					</actionList>
					
					<distributionFileList>
						<distributionDirectory>
							<origin>licenses</origin>
						</distributionDirectory>
					</distributionFileList>
				</folder>

				<folder>
					<description>Program Files</description>
					<destination>${installdir}</destination>
					<name>programfileswindows</name>
					<platforms>windows</platforms>
					<actionList>
						<substitute>
							<files>*/allctl.bat;*/serviceinstall.bat;*/servicerun.bat;*/runctl.bat</files>
							<type>regexp</type>
							<substitutionList>
								<substitution>
									<pattern>@@BITROCK_APACHE_ROOTDIR@@</pattern>
									<value>${installdir.dos}\apache2</value>
								</substitution>
								<substitution>
									<pattern>@@BITROCK_MYSQL_ROOTDIR@@</pattern>
									<value>${installdir.dos}\mysql</value>
								</substitution>
								<substitution>
									<pattern>@@BITROCK_PRODUCT_SHORTNAME@@</pattern>
									<value>${product_shortname}</value>
								</substitution>
							</substitutionList>
						</substitute>
					</actionList>
					<distributionFileList>
						<distributionDirectory>
							<origin>bin</origin>
						</distributionDirectory>
						<distributionDirectory>
							<origin>images</origin>
						</distributionDirectory>
					</distributionFileList>
				</folder>
			
				<folder destination="${installdir}" name="htdocs">
					<distributionFileList>
						<distributionDirectory origin="htdocs" />
					</distributionFileList>
				</folder>
						
				<folder destination="${installdir}/htdocs" name="sugarcrm">
					<distributionFileList>
						<distributionDirectory origin="sugarcrm" />
					</distributionFileList>						
					<actionList>
					  <actionGroup>
					    <actionList>
					      <changeOwnerAndGroup>
						<files>*</files>
						<owner>nobody</owner>
						<ruleEvaluationLogic>or</ruleEvaluationLogic>
						<ruleList>
						  <platformTest type="linux" />
						  <platformTest type="solaris" />
						</ruleList>
					      </changeOwnerAndGroup>					
					    </actionList>		
					    <ruleList>
					      <compareText text="${installer_root_install}" logic="equals" value="1"/>
					    </ruleList>
					  </actionGroup>
					</actionList>
				</folder>				
					   
				<folder destination="${installdir}" name="images" platforms="windows">
					<distributionFileList>
						<distributionDirectory origin="images" />
					</distributionFileList>
				</folder>
				
				<folder destination="${installdir}" name="tmp" platforms="osx">
					<actionList>
						<setInstallerVariable>
							<name>systemuser</name>
							<value>${env(USER)}</value>
						</setInstallerVariable>
						<substitute>
							<files>*/Sugarcrm</files>
							<type>regexp</type>
							<substitutionList>
								<substitution>
									<pattern>@@BITROCK_INSTALLDIR@@</pattern>
									<value>${installdir}</value>
								</substitution>
								<substitution>
									<pattern>@@BITROCK_MACUSER@@</pattern>
									<value>${systemuser}</value>
								</substitution>
							</substitutionList>
						</substitute>
					</actionList>
					<distributionFileList>
						<distributionDirectory origin="tmp" />
					</distributionFileList>
				</folder>
			</folderList>


			<startMenuShortcutList>
				<startMenuLinkShortcut>
					<comment>SugarCRM Website</comment>
					<name>SugarCRM Website</name>
					<url>http://www.sugarcrm.com</url>
					<windowsIcon></windowsIcon>
				</startMenuLinkShortcut>
				<startMenuLinkShortcut>
					<comment>Start Here</comment>
					<name>Start Here</name>
					<url>http://127.0.0.1:${web_server_port}/sugarcrm/index.php</url>
					<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
				</startMenuLinkShortcut>
				<startMenuShortcut>
					<comment>Uninstall ${product_fullname}</comment>
					<name>Uninstall ${product_fullname}</name>
					<windowsExec>${installdir}\uninstall.exe</windowsExec>
					<windowsExecArgs></windowsExecArgs>
					<windowsIcon></windowsIcon>
					<windowsPath>${installdir}</windowsPath>
				</startMenuShortcut>
				<startMenuFolder>
					<name>Run SugarCRM</name>
					<platforms>windows</platforms>
					<startMenuShortcutList>
						<startMenuFolder>
							<name>All</name>
							<platforms>windows</platforms>
							<startMenuShortcutList>
								<startMenuShortcut>
									<comment>Start ${product_fullname}</comment>
									<name>Start ${product_fullname}</name>
									<windowsExec>${installdir}\bin\allctl.bat</windowsExec>
									<windowsExecArgs>start</windowsExecArgs>
									<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
									<windowsPath>${installdir}/bin/</windowsPath>
								</startMenuShortcut>
								<startMenuShortcut>
									<comment>Stop ${product_fullname}</comment>
									<name>Stop ${product_fullname}</name>
									<windowsExec>${installdir}\bin\allctl.bat</windowsExec>
									<windowsExecArgs>stop</windowsExecArgs>
									<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
									<windowsPath>${installdir}/bin/</windowsPath>
								</startMenuShortcut>
								<startMenuShortcut>
									<comment>Restart ${product_fullname}</comment>
									<name>Restart ${product_fullname}</name>
									<windowsExec>${installdir}\bin\allctl.bat</windowsExec>
									<windowsExecArgs>restart</windowsExecArgs>
									<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
									<windowsPath>${installdir}/bin/</windowsPath>
								</startMenuShortcut>
							</startMenuShortcutList>
						</startMenuFolder>
						<startMenuFolder>
							<name>MySQL</name>
							<platforms>windows</platforms>
							<startMenuShortcutList>
								<startMenuShortcut>
									<comment>Start MySQL</comment>
									<name>Start MySQL</name>
									<windowsExec>${installdir}/bin/runctl.bat</windowsExec>
									<windowsExecArgs>mysql start</windowsExecArgs>
									<windowsIcon>${installdir}/images/mysql.ico</windowsIcon>
									<windowsPath>${installdir}/</windowsPath>
								</startMenuShortcut>
								<startMenuShortcut>
									<comment>Stop MySQL</comment>
									<name>Stop MySQL</name>
									<windowsExec>${installdir}/bin/runctl.bat</windowsExec>
									<windowsExecArgs>mysql stop</windowsExecArgs>
									<windowsIcon>${installdir}/images/mysql.ico</windowsIcon>
									<windowsPath>${installdir}/</windowsPath>
								</startMenuShortcut>
								<startMenuShortcut>
									<comment>Restart MySQL</comment>
									<name>Restart MySQL</name>
									<windowsExec>${installdir}/bin/runctl.bat</windowsExec>
									<windowsExecArgs>mysql restart</windowsExecArgs>
									<windowsIcon>${installdir}/images/mysql.ico</windowsIcon>
									<windowsPath>${installdir}/</windowsPath>
								</startMenuShortcut>
							</startMenuShortcutList>
						</startMenuFolder>
						<startMenuFolder>
							<name>Apache</name>
							<platforms>windows</platforms>
							<startMenuShortcutList>
								<startMenuShortcut>
									<comment>Start Apache</comment>
									<name>Start Apache</name>
									<windowsExec>${installdir}/bin/runctl.bat</windowsExec>
									<windowsExecArgs>apache start</windowsExecArgs>
									<windowsIcon>${installdir}/images/apache.ico</windowsIcon>
									<windowsPath>${installdir}/</windowsPath>
								</startMenuShortcut>
								<startMenuShortcut>
									<comment>Stop Apache</comment>
									<name>Stop Apache</name>
									<windowsExec>${installdir}/bin/runctl.bat</windowsExec>
									<windowsExecArgs>apache stop</windowsExecArgs>
									<windowsIcon>${installdir}/images/apache.ico</windowsIcon>
									<windowsPath>${installdir}/</windowsPath>
								</startMenuShortcut>
								<startMenuShortcut>
									<comment>Restart Apache</comment>
									<name>Restart Apache</name>
									<windowsExec>${installdir}/bin/runctl.bat</windowsExec>
									<windowsExecArgs>apache restart</windowsExecArgs>
									<windowsIcon>${installdir}/images/apache.ico</windowsIcon>
									<windowsPath>${installdir}/</windowsPath>
								</startMenuShortcut>
							</startMenuShortcutList>
						</startMenuFolder>
					</startMenuShortcutList>
				</startMenuFolder>
				<startMenuFolder>
					<name>SugarCRM Service</name>
					<platforms>windows</platforms>
					<startMenuShortcutList>
						<startMenuShortcut>
							<comment>Install ${product_fullname} as service</comment>
							<name>Install ${product_fullname} as service</name>
							<windowsExec>${installdir}/bin/serviceinstall.bat</windowsExec>
							<windowsExecArgs>INSTALL</windowsExecArgs>
							<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
							<windowsPath>${installdir}/</windowsPath>
						</startMenuShortcut>
						<startMenuShortcut>
							<comment>Start ${product_fullname} service</comment>
							<name>Start ${product_fullname} service</name>
							<windowsExec>${installdir}/bin/servicerun.bat</windowsExec>
							<windowsExecArgs>START</windowsExecArgs>
							<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
							<windowsPath>${installdir}/</windowsPath>
						</startMenuShortcut>
						<startMenuShortcut>
							<comment>Stop ${product_fullname} service</comment>
							<name>Stop ${product_fullname} service</name>
							<windowsExec>${installdir}/bin/servicerun.bat</windowsExec>
							<windowsExecArgs>STOP</windowsExecArgs>
							<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
							<windowsPath>${installdir}/</windowsPath>
						</startMenuShortcut>
						<startMenuShortcut>
							<comment>Uninstall ${product_fullname} service</comment>
							<name>Uninstall ${product_fullname} service</name>
							<windowsExec>${installdir}/bin/serviceinstall.bat</windowsExec>
							<windowsExecArgs>REMOVE</windowsExecArgs>
							<windowsIcon>${installdir}/images/sugarcrm.ico</windowsIcon>
							<windowsPath>${installdir}/</windowsPath>
						</startMenuShortcut>
					</startMenuShortcutList>
				</startMenuFolder>
			</startMenuShortcutList>
			<postInstallationActionList>
                <substitute>
                    <files>${installdir}/sugarctl.sh;${installdir}/common/scripts/sugarcrm;${installdir}/common/bin/openssl</files>
                    <type>exact</type>
                    <substitutionList>
                        <substitution>
                            <pattern>@@BITROCK_INSTALLDIR@@</pattern>
                            <value>${installdir.unix}</value>
                        </substitution>		
                        <substitution>
                            <pattern>@@BITROCK_COMMON_ROOTDIR@@</pattern>
                            <value>${installdir}/common</value>
                        </substitution>				
                        <substitution>
                            <pattern>@@BITROCK_MYSQL_ROOTDIR@@</pattern>
                            <value>${installdir.unix}/mysql</value>
                        </substitution>
                        <substitution>
                            <pattern>@@BITROCK_PHP_ROOTDIR@@</pattern>
                            <value>${installdir.unix}/php</value>
                        </substitution>
                        <substitution>
                            <pattern>@@BITROCK_MYSQL_PORT@@</pattern>
                            <value>${mysql_port}</value>
                        </substitution>
                        <substitution>
                            <pattern>@@BITROCK_MYSQL_PASSWORD@@</pattern>
                            <value>${mysql_root_password}</value>
                        </substitution>
                        <substitution>
                            <pattern>@@BITROCK_APACHE_ROOTDIR@@</pattern>
                            <value>${installdir.unix}/apache2</value>
                        </substitution>
                        <substitution>
                            <pattern>@@BITROCK_APACHE_PORT@@</pattern>
                            <value>${apache_server_port}</value>
                        </substitution>					
                        <substitution>
                            <pattern>LD_LIBRARY_PATH</pattern>
                            <value>DYLD_LIBRARY_PATH</value>
                            <ruleList>	
                                <platformTest type="osx" />
                            </ruleList>								
                        </substitution>
                    </substitutionList>
                    <ruleList>	
                        <platformTest type="unix" />
                    </ruleList>								                    
                </substitute>
            </postInstallationActionList>
		</component>

	<include file="apache.xml"/>		
	<include file="php.xml"/>
        <include file="mysql.xml" />
        <include file="phpmyadmin.xml" />
        <include file="apache-php.xml" />
        <include file="mysql-php.xml" />
        <include file="mysql-apache.xml" />
	</componentList>

    <customLanguageFileList/>
    <fileList/>
    <finalPageActionList/>
    <parameterList>
	    <choiceParameter>
		    <name>install_type</name>
		    <title>Install Type</title>
		    <description/>
		    <explanation>You can choose to perform a typical install or a custom install. The typical install requires minimum information, and is recommended for new users. The custom install offers additional options (which can also be set from the admin screens after installation), and is recommended for advanced users.</explanation>
		    <displayType>radiobuttons</displayType>
		    <ask>1</ask>
		    <allowEmptyValue>0</allowEmptyValue>
		    <default>typical</default>
		    <width>40</width>
		    <optionList>
			    <option>
				    <text>Typical install</text>
				    <value>typical</value>
			    </option>
			    <option>
				    <text>Custom install</text>
				    <value>custom</value>
			    </option>
		    </optionList>
	    </choiceParameter>


        <choiceParameter>
            <name>http_server</name>
            <title>Web Server</title>
            <description/>
            <insertBefore>installdir</insertBefore>
            <explanation>Which Web server would you like to use:</explanation>
            <value/>
            <default>apache</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>1</ask>
            <cliOptionName>http_server</cliOptionName>
            <displayType>radiobuttons</displayType>
            <leftImage/>
            <width>40</width>
            <optionList>
                <option>
                    <text>Apache HTTP Server (additional 12 MB)</text>
                    <value>apache</value>
                </option>
                <option>
                    <text>Microsoft IIS Server</text>
                    <value>iis</value>
                </option>
            </optionList>
            <preShowPageActionList>
				<componentSelection>
					<deselect>apache</deselect>
				</componentSelection>
				<componentSelection>
					<deselect>iis</deselect>
				</componentSelection>
			</preShowPageActionList>
			<postShowPageActionList>
				<componentSelection>
					<select>${http_server}</select>
				</componentSelection>
			</postShowPageActionList>
            <validationActionList>
            </validationActionList>
			<ruleList>	
				<platformTest type="windows-hidden" />
			</ruleList>		
        </choiceParameter>
        <choiceParameter>
            <name>db_server</name>
            <title>Database Server</title>
            <description/>
            <insertBefore>installdir</insertBefore>
            <explanation>Which database would you like to use:</explanation>
            <value/>
            <default>mysql</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>1</ask>
            <cliOptionName>db_server</cliOptionName>
            <displayType>radiobuttons</displayType>
            <leftImage/>
            <width>40</width>
            <optionList>
                <option>
                    <text>MySQL Server (additional 63 MB)</text>
                    <value>mysql</value>
                </option>
                <option>
                    <text>Microsoft SQL Server</text>
                    <value>mssql</value>
                </option>
            </optionList>
            <preShowPageActionList>
				<componentSelection>
					<deselect>mysql</deselect>
                </componentSelection>
				<componentSelection>
					<deselect>mssql</deselect>
				</componentSelection>
			</preShowPageActionList>
			<postShowPageActionList>
				<componentSelection>
					<select>${db_server}</select>
				</componentSelection>
            </postShowPageActionList>
            <ruleList>	
				<platformTest type="windows-hidden" />
			</ruleList>		
        </choiceParameter>
        <directoryParameter>
            <name>installdir</name>
            <title></title>
            <description>Installation directory</description>
            <explanation>Please specify the directory where ${product_fullname} will be installed</explanation>
			<value>${platform_install_prefix}/${product_shortname}-${product_version}</value>
            <default>${platform_install_prefix}/${product_shortname}-${product_version}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <leftImage></leftImage>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>30</width>
            <validationActionList>
                <throwError>
                    <text>The directory ${installdir.unix}/mysql/ contains a SugarCRM database from a previous installation. Please remove it or choose a new installation directory.</text>
                    <ruleList>
                        <fileTest path="${installdir}/mysql/data/sugarcrm" condition="is_directory" />
                    </ruleList>
                </throwError>		
            </validationActionList>	    
        </directoryParameter>
        <stringParameter>
            <name>systemname</name>
            <title>System Name</title>
            <description>System Name</description>
            <explanation>This will be displayed in the Title Bar of users who visit this SugarCRM installation</explanation>
            <value>127.0.0.1</value>
            <default>127.0.0.1</default>
            <allowEmptyValue>1</allowEmptyValue>
            <ask>1</ask>
            <cliOptionName>System Name</cliOptionName>
            <leftImage></leftImage>
            <width>40</width>
        </stringParameter>

	<stringParameter>
		<name>baseurl</name>
		<title>Base URL</title>
		<description>Base URL</description>
		<explanation>Enter the base URL for your Sugar application. For example, using "localhost" means access is allowed from only from this machine (which is the localhost).</explanation>
		<value>http://127.0.0.1/sugarcrm/</value>
		<default>http://127.0.0.1/sugarcrm/</default>
		<allowEmptyValue>1</allowEmptyValue>
		<ask>1</ask>
		<ruleList>
			<compareText text="${install_type}" logic="equals" value="custom" />
		</ruleList>
	</stringParameter>
        
		<passwordParameter>
			<name>sugarpassword</name>
			<title>SugarCRM Admin Password</title>
			<description>Password</description>
			<explanation>Password for the SugarCRM admin user. The administration user will be 'admin'</explanation> 
			<value></value>
			<default></default>
			<allowEmptyValue>0</allowEmptyValue>
			<ask>yes</ask>
			<cliOptionName></cliOptionName>
			<descriptionRetype>Re-enter</descriptionRetype>
			<leftImage></leftImage>
			<width>40</width>
			<validationActionList>
				<throwError>
					<text>You need to provide a non-empty password</text>
					<ruleList>
						<compareText text="${sugarpassword}" logic="equals" value="" />
					</ruleList>
				</throwError>
			</validationActionList>
		</passwordParameter>
		
<!--
		<booleanParameter>
			<name>demo</name>
			<default>1</default>
			<title>Demo data</title>
			<value>0</value>
			<ask>1</ask>
			<description>Populate with demo data?</description>
			<default>0</default>
			<explanation>Populate SugarCRM database with demo data? 
This process may take several minutes to complete.</explanation>
			<ruleList>
				<compareText text="${install_type}" logic="equals" value="typical" />
			</ruleList>
		</booleanParameter>
-->

		<choiceParameter>
			<name>demoData</name>
			<title>Demo data</title>
			<description>Populate with demo data?</description>
			<explanation>You can choose to populate the SugarCRM database with demo data. This process may take several minutes to complete.</explanation>
			<displayType>radiobuttons</displayType>
			<ask>1</ask>
			<allowEmptyValue>0</allowEmptyValue>
			<default>yes</default>
			<optionList>
				<option>
					<text>Yes</text>
					<value>yes</value>
				</option>
				<option>
					<text>No</text>
					<value>no</value>
				</option>
			</optionList>
<!--
			<ruleList>
				<compareText text="${install_type}" logic="equals" value="custom" />
			</ruleList>
-->
		</choiceParameter>

		<parameterGroup>
			<name>group1</name>
			<title>Statistics and updates</title>
			<parameterList>
				<!--booleanParameter>
					<name>setup_site_sugarbeet_anonymous_stats</name>
					<title>Anonymous stats</title>
					<description>Send anonymous usage statistics?</description>
					<explanation>If selected, Sugar will send anonymous statistics about your installation to SugarCRM Inc. every time your system checks for new versions. This information will help us better understand how the application is used and guide improvements to the product.</explanation>
					<ask>1</ask>
					<default>1</default>
				</booleanParameter-->
				<booleanParameter>
					<name>setup_site_sugarbeet_automatic_checks</name>
					<title>Updates</title>
					<description>Automatically check for updates?</description>
					<explanation>If selected, the system periodically checks for updated versions of the application.</explanation>
					<ask>1</ask>
					<default>1</default>
				</booleanParameter>
			</parameterList>
			<ruleList>
				<compareText text="${install_type}" logic="equals" value="custom" />
			</ruleList>
		</parameterGroup>

        <parameterGroup>
            <name>group2</name>
            <title>Application ID</title>
            <parameterList>
                  <booleanParameter>
                        <name>setup_site_specify_guid</name>
                        <title>Provide an Application ID?</title>
                        <description>Provide your own application ID?</description>
                        <explanation>If selected, you must enter an application ID to override the auto-generated ID that ensures that sessions of one Sugar instance are not used by other instances. If you have a cluster of Sugar installations, they all must share the same application ID.</explanation>
                        <ask>1</ask><default>0</default>
                  </booleanParameter>
                  <stringParameter>
                        <name>setup_site_guid</name>
                        <title>Application ID</title>
                        <description>If you are providing an application ID, enter it here.</description>
                        <ask>1</ask>
                        <validationActionList>
                            <throwError text="Please enter the Application ID" >
                                <ruleList>
                                    <compareText text="${setup_site_guid}" logic="equals" value="" />
                                    <compareText text="${setup_site_specify_guid}" logic="equals" value="1" />
                                 </ruleList>
                             </throwError>
                        </validationActionList>
                  </stringParameter>
            </parameterList>
            <ruleList>
                <compareText text="${install_type}" logic="equals" value="custom" />
            </ruleList>
        </parameterGroup>

		<parameterGroup>
			<name>group3</name>
			<title>Locale settings</title>
			<parameterList>
				<choiceParameter>
					<name>default_date_format</name>
					<description>Default date format</description>
					<optionList>
						<option>
							<value>Y_dash_m_dash_d</value>
							<text>2006-12-23</text>
						</option>
						<option>
							<value>d_dash_m_dash_Y</value>
							<text>23-12-2006</text>
						</option>
						<option>
							<value>Y_slash_m_slash_d</value>
							<text>2006/12/23</text>
						</option>
						<option>
							<value>d_slash_m_slash_Y</value>
							<text>23/12/2006</text>
						</option>
						<option>
							<value>m_slash_d_slash_Y</value>
							<text>12/23/2006</text>
						</option>
						<option>
							<value>Y_dot_m_dot_d</value>
							<text>2006.12.23</text>
						</option>
						<option>
							<value>d_dot_m_dot_Y</value>
							<text>23.12.2006</text>
						</option>
					</optionList>
					<default>m_slash_d_slash_Y</default>
					<ask>1</ask>
				</choiceParameter>
				<choiceParameter>
					<name>default_time_format</name>
					<description>Default time format</description>
					<optionList>
						<option>
							<value>H_colon_i</value>
							<text>23:00</text>
						</option>
						<option>
							<value>h_colon_ia</value>
							<text>11:00pm</text>
						</option>
						<option>
							<value>H_dot_i</value>
							<text>23.00</text>
						</option>
						<option>
							<value>h_dot_ia</value>
							<text>11.00pm</text>
						</option>
						<option>
							<value>h_dot_iA</value>
							<text>11.00PM</text>
						</option>
					</optionList>
					<default>h_colon_ia</default>
					<ask>1</ask>
				</choiceParameter>
				<choiceParameter>
					<name>default_currency_iso4217</name>
					<title>Default currency></title>
					<description>Default currency</description>
					<optionList>
						<option> <value>AUD</value> <text>Australian Dollars</text> </option>
						<option> <value>BRL</value> <text>Brazilian Reals</text> </option>
						<option> <value>GBP</value> <text>British Pounds</text> </option>
						<option> <value>CAD</value> <text>Canadian Dollars</text> </option>
						<option> <value>CNY</value> <text>Chinese Yuan</text> </option>
						<option> <value>EUR</value> <text>Euro</text> </option>
						<option> <value>HKD</value> <text>Hong Kong Dollars</text> </option>
						<option> <value>INR</value> <text>Indian Rupees</text> </option>
						<option> <value>KRW</value> <text>Korean Won</text> </option>
						<option> <value>YEN</value> <text>Japanese Yen</text> </option>
						<option> <value>MXM</value> <text>Mexican Pesos</text> </option>
						<option> <value>SGD</value> <text>Singaporean Dollars</text> </option>
						<option> <value>CHF</value> <text>Swiss Franc</text> </option>
						<option> <value>THB</value> <text>Thai Baht</text> </option>
						<option> <value>USD</value> <text>US Dollars</text> </option>
					</optionList>
					<default>USD</default>
					<ask>1</ask>
				</choiceParameter>
				<stringParameter>
					<name>default_currency_significant_digits</name>
					<description>Significant digits of currency</description>
					<default>2</default>
					<validationActionList>
						<throwError>
							<text>Please enter a valid number of significant digits.</text>
							<ruleList>
								<regExMatch text="${default_currency_significant_digits}" pattern="[^0-9]" logic="matches" />
							</ruleList>
						</throwError>
					</validationActionList>
					<ask>1</ask>
				</stringParameter>
				<stringParameter>
					<name>default_number_grouping_seperator</name>
					<description>Thousands separator</description>
					<default>,</default>
					<ask>1</ask>
				</stringParameter>
				<stringParameter>
					<name>default_decimal_seperator</name>
					<description>Decimal separator</description>
					<default>.</default>
					<ask>1</ask>
				</stringParameter>
			</parameterList>

			<ruleList>
				<compareText text="${install_type}" logic="equals" value="custom" />
			</ruleList>
		</parameterGroup>


		<stringParameter>
			<name>slkeyusers</name>
			<default>1</default>
			<title>Key Users</title>
			<ask>1</ask>
			<description>Number of users</description>
			<explanation>Please enter the number or users of your license key.</explanation>
			<ruleList>
				<compareText text="${sugarinstall}" logic="equals" value="spro" />
			</ruleList>
		</stringParameter>
		
		<stringParameter>
			<name>slkeyexpiredate</name>
			<default>2010-12-12</default>
			<title>License Key Expire Date</title>
			<ask>1</ask>
			<description>Expire Date</description>
			<explanation>Please enter the license key expire date.</explanation>
			<ruleList>
				<compareText text="${sugarinstall}" logic="equals" value="spro" />
			</ruleList>
		</stringParameter>
		
		<stringParameter>
			<name>slkey</name>
			<default>sugar</default>
			<title>License Key</title>
			<ask>1</ask>
			<description>License Key for sugarCRM</description>
			<explanation>Please enter the license key.</explanation>
			<ruleList>
				<compareText text="${sugarinstall}" logic="equals" value="spro" />
			</ruleList>
                        <validationActionList>
                            <throwError>
                                <text>You need to provide a License Key for SugarCRM.</text>
                                <ruleList>
                                    <compareText text="${slkey}" logic="equals" value="" />
                                </ruleList>
                            </throwError>
                        </validationActionList>
		</stringParameter>
        <stringParameter>
            <name>slkey_oc_licenses</name>
            <title>Offline Client Licenses</title>
            <description>Offline Client Licenses</description>
            <explanation>Please enter the number of purchased Offline Clients</explanation>
            <value>0</value>
            <default>0</default>
            <allowEmptyValue>1</allowEmptyValue>
            <ask>1</ask>
            <cliOptionName></cliOptionName>
            <leftImage></leftImage>
            <width>30</width>
            <ruleList>
                <compareText logic="equals" text="${sugarinstall}" value="spro">
                    <nocase>0</nocase>
                </compareText>
            </ruleList>
        </stringParameter>		
		<booleanParameter>
			<name>installAsService</name>
			<title>Install as a service</title>
			<description>Install service</description>
			<explanation>You can optionally register ${product_fullname} as a service. This way it will automatically be started every time the machine is started. Install ${product_fullname} as a service?.</explanation>
			<value>1</value>
			<default>0</default>
			<ask>1</ask>
			<cliOptionName></cliOptionName>
			<leftImage></leftImage>
			<ruleEvaluationLogic>or</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="windows" />
				<platformTest type="osx" />
				<ruleGroup>
					<ruleEvaluationLogic>and</ruleEvaluationLogic>
					<ruleList>
						<compareText text="${installer_root_install}" logic="equals" value="1" />
						<platformTest type="unix" />
					</ruleList>
				</ruleGroup>
 			</ruleList>
		</booleanParameter>


		
		<passwordParameter>
			<name>sudopass</name>
			<default></default>
			<askForConfirmation>0</askForConfirmation>
			<title>System Administrator Password</title>
			<ask>1</ask>
			<description>System Administrator Password</description>
			<explanation>Please enter the System Administrator Password for this computer.</explanation>
			<ruleEvaluationLogic>and</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="osx" />
				<compareText text="${installAsService}" logic="equals" value="1" />
				<!--<compareText text="${installer_root_install}" logic="equals" value="1" />-->
			</ruleList>
			<validationActionList>
				<throwError>
					<text>You need to provide a non-empty password</text>
					<ruleList>
						<compareText text="${sudopass}" logic="equals" value="" />
					</ruleList>
				</throwError>
                              <actionGroup>
				    <abortOnError>0</abortOnError>
				    <showMessageOnError>0</showMessageOnError>
				    <actionList>
					  <setInstallerVariable name="sudopass_valid" value="0" />
					  <runProgram>
					        <program>echo</program>                
						<programArguments>'${sudopass}' | sudo -S ls</programArguments>
					  </runProgram>
					  <setInstallerVariable name="sudopass_valid" value="1" />
				    </actionList>
                              </actionGroup>
			      <throwError>
				    <text>The administrator password is not valid. Please re-enter the password.</text>
				    <ruleList>
				        <compareText text="${sudopass_valid}" logic="does_not_equal" value="1" />
				    </ruleList>
                              </throwError>

			</validationActionList>
		</passwordParameter>
		
	</parameterList>

	<!-- replace special characters, i.e., substitute - for _dash_ -->
	<readyToInstallActionList>

		<setInstallerVariableFromRegEx>
			<name>default_date_format</name>
			<text>${default_date_format}</text>
			<substitution>/</substitution>
			<pattern>_slash_</pattern>
		</setInstallerVariableFromRegEx>
		<setInstallerVariableFromRegEx>
			<name>default_date_format</name>
			<text>${default_date_format}</text>
			<substitution>-</substitution>
			<pattern>_dash_</pattern>
		</setInstallerVariableFromRegEx>
		<setInstallerVariableFromRegEx>
			<name>default_date_format</name>
			<text>${default_date_format}</text>
			<substitution>.</substitution>
			<pattern>_dot_</pattern>
		</setInstallerVariableFromRegEx>
		<setInstallerVariableFromRegEx>
			<name>default_date_format</name>
			<text>${default_date_format}</text>
			<substitution>:</substitution>
			<pattern>_colon_</pattern>
		</setInstallerVariableFromRegEx>
		
		<setInstallerVariableFromRegEx>
			<name>default_time_format</name>
			<text>${default_time_format}</text>
			<substitution>:</substitution>
			<pattern>_colon_</pattern>
		</setInstallerVariableFromRegEx>
		<setInstallerVariableFromRegEx>
			<name>default_time_format</name>
			<text>${default_time_format}</text>
			<substitution>.</substitution>
			<pattern>_dot_</pattern>
		</setInstallerVariableFromRegEx>

	</readyToInstallActionList>
    
    <!-- SugarCRM configuration -->

    <postInstallationActionList>
        <substitute>
            <files>${php_directory}/php.ini;${php_directory}/php.ini-recommended</files>
            <substitutionList>        
                <substitution>
                    <pattern>open_basedir =</pattern>
                    <value>;open_basedir =</value> 
                    <ruleList>
                        <platformTest type="windows" />
                    </ruleList>								
                </substitution>			
            </substitutionList>
        </substitute>
        
        <writeFile>
            <path>${installdir}/htdocs/sugarcrm/config_si.php</path>
            <text>&lt;?php
    $sugar_config_si = array (
    'setup_db_host_name' => 'localhost',
    'setup_db_database_name' => 'sugarcrm',
    'setup_db_drop_tables' => 0,
    'setup_db_create_database' => 1,
    'demoData' => '${demoData}',
    'setup_site_admin_user_name' => 'admin',
    'setup_site_admin_password' => '${sugarpassword}',
    'setup_db_create_sugarsales_user' => 0,
    'setup_db_admin_user_name' => 'root',
    'setup_db_admin_password' => '${database_root_password}',
    'setup_license_key_users' => ${slkeyusers},
    'setup_license_key_expire_date' => '${slkeyexpiredate}',
    'setup_license_key_oc_licences' =&gt; ${slkey_oc_licenses},
    'setup_license_key' => '${slkey}',
    'setup_site_url' => 'http://${web_server_domainname}:${web_server_port}/sugarcrm',
    'dbUSRData' => '${dbUSRData}',
    'setup_db_sugarsales_user' => 'root',
    'setup_db_sugarsales_password' => '${database_root_password}',
    'setup_db_type' => 'mysql',
    'setup_system_name' =&gt; '${systemname}',
    'default_currency_iso4217' => 'USD',
    'default_currency_name' => 'US Dollars',
    'default_currency_significant_digits' => '2',
    'default_currency_symbol' => '$',
    'default_date_format' => 'm/d/Y',
    'default_time_format' => 'h:ia',
    'default_decimal_seperator' => '.',
    'default_export_charset' => 'ISO-8859-1',
    'default_language' => 'en_us',
    'default_locale_name_format' => 's f l',
    'default_number_grouping_seperator' => ',',
    'export_delimiter' => ',',
    'setup_site_sugarbeet_automatic_checks' => true,
    );
    ?&gt; 
            </text>
	    <ruleList>
		    <compareText text="${install_type}" logic="equals" value="typical" />
	    </ruleList>
        </writeFile>

        <writeFile>
            <path>${installdir}/htdocs/sugarcrm/config_si.php</path>
            <text>&lt;?php
    $sugar_config_si = array (
    'setup_db_host_name' => 'localhost',
    'setup_db_database_name' => 'sugarcrm',
    'setup_db_drop_tables' => 0,
    'setup_db_create_database' => 1,
    'setup_site_admin_user_name' => 'admin',
    'setup_site_admin_password' => '${sugarpassword}',
    'setup_db_create_sugarsales_user' => 0,
    'setup_db_admin_user_name' => 'root',
    'setup_db_admin_password' => '${database_root_password}',
    'setup_license_key_users' => ${slkeyusers},
    'setup_license_key_expire_date' => '${slkeyexpiredate}',
    'setup_license_key_oc_licences' =&gt; ${slkey_oc_licenses},
    'setup_license_key' => '${slkey}',
    'setup_site_url' => 'http://${web_server_domainname}:${web_server_port}/sugarcrm',
    'dbUSRData' => '${dbUSRData}',
    'setup_db_sugarsales_user' => '${setup_db_sugarsales_user}',
    'setup_db_sugarsales_password' => '${setup_db_sugarsales_password}',
    'setup_db_type' => 'mysql',
    'setup_system_name' =&gt; '${systemname}',
    'default_currency_iso4217' => '${default_currency_iso4217}',
    //'default_currency_name' => 'US Dollars',
    'default_currency_significant_digits' => '2',
    //'default_currency_symbol' => '$',
    'default_date_format' => '${default_date_format}',
    'default_time_format' => '${default_time_format}',
    'default_decimal_seperator' => '${default_decimal_seperator}',
    'default_export_charset' => 'ISO-8859-1',
    'default_language' => 'en_us',
    'default_locale_name_format' => 's f l',
    'default_number_grouping_seperator' => '${default_number_grouping_seperator}',
    'export_delimiter' => ',',
    'demoData' => '${demoData}',
    'setup_site_sugarbeet_anonymous_stats' => '1',
    'setup_site_sugarbeet_automatic_checks' => '${setup_site_sugarbeet_automatic_checks}',
    'setup_site_specify_guid' => '${setup_site_specify_guid}',
    'setup_site_guid' => '${setup_site_guid}',
    );
    ?&gt; 
            </text>
	    <ruleList>
		    <compareText text="${install_type}" logic="equals" value="custom" />
	    </ruleList>
        </writeFile>	

      <changePermissions>
         <files>${installdir}/mysql/scripts/myscript.sh</files>
         <permissions>755</permissions>
                        <ruleList>
            <platformTest type="unix" />
         </ruleList>
      </changePermissions>
             
	<actionGroup>
	  <actionList>
	    <runProgram>
			<program>touch</program>
			<programArguments>${installdir}/htdocs/sugarcrm/.htaccess</programArguments>
			<ruleEvaluationLogic>or</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="linux" />
				<platformTest type="solaris" />
			</ruleList>
		</runProgram>
		<changeOwnerAndGroup>
			<files>${installdir}/htdocs/sugarcrm/.htaccess</files>
			<owner>nobody</owner>
			<ruleEvaluationLogic>or</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="linux" />
				<platformTest type="solaris" />
			</ruleList>
		</changeOwnerAndGroup>
		<changePermissions>
			<files>${installdir}/htdocs/sugarcrm/config.php</files>
			<permissions>666</permissions>
			<ruleList>
				<platformTest type="unix" />
			</ruleList>
		</changePermissions>
	  </actionList>
	  <ruleList>
	    <compareText text="${installer_root_install}" logic="equals" value="1" />
	  </ruleList>
	</actionGroup>

        <changePermissions>
            <files>${installdir}/php/tmp</files>
            <permissions>777</permissions>
			<ruleList>
				<platformTest type="unix" />
			</ruleList>
        </changePermissions>
						

		<runProgram>
			<program>${installdir}/sugarctl.sh</program>
			<programArguments>start  &gt; /dev/null 2&gt; /dev/null &lt; /dev/null &amp;</programArguments>
			<ruleList>
				<platformTest type="unix" />
			</ruleList>
		</runProgram>
		<wait>
			<ms>10000</ms>
			<progressText>Starting MySQL</progressText>
			<ruleList>
				<platformTest type="unix" />
			</ruleList>
		</wait>
		<httpGet>
			<url>http://127.0.0.1:${apache_server_port}/sugarcrm/install.php?goto=SilentInstall&amp;cli=true</url>
			<filename>${installdir}/silent.log</filename>
			<progressText>Initializing database, this may take a few minutes.</progressText>
			<ruleList>
				<platformTest type="unix" />
			</ruleList>
		</httpGet>

	<actionGroup>
	  <actionList>
		<changeOwnerAndGroup>
			<files>${installdir}/htdocs/sugarcrm/config_si.php</files>
			<owner>nobody</owner>
			<ruleEvaluationLogic>or</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="linux" />
				<platformTest type="solaris" />
			</ruleList>
		</changeOwnerAndGroup>
		<changePermissions>
			<files>${installdir}/htdocs/sugarcrm/config.php</files>
			<permissions>664</permissions>
			<ruleEvaluationLogic>or</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="linux" />
				<platformTest type="solaris" />
			</ruleList>
		</changePermissions>
		<changeOwnerAndGroup>
			<files>${installdir}/htdocs/sugarcrm/.htaccess</files>
			<owner>root</owner>
			<ruleEvaluationLogic>or</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="linux" />
				<platformTest type="solaris" />
			</ruleList>
		</changeOwnerAndGroup>
	  </actionList>
	  <ruleList>
	    <compareText text="${installer_root_install}" logic="equals" value="1" />
	  </ruleList>
	</actionGroup>


		<writeFile>
			<path>${installdir}/install_summary.txt</path>
			<text>
Installation Summary
------------------------

SugarCRM was installed with the following settings

Installation directory: ${installdir}/
Apache HTTP port: ${web_server_port}
Apache HTTPS port: ${web_server_sslport}
MySQL port: ${database_port}

On Linux, OSX and Solaris systems:
To start SugarCRM: ${installdir}/sugarctl.sh start
To stop SugarCRM: ${installdir}/sugarctl.sh stop

To access SugarCRM, point your browser to:
http://${web_server_domainname}:${web_server_port}/sugarcrm/

To access SugarCRM with SSL, point your browser to:
https://${web_server_domainname}:${web_server_sslport}/sugarcrm/
            </text>
        </writeFile>

        
        <actionGroup>
            <actionList>
                <runProgram>
                    <program>${installdir}\mysql\bin\mysqld.exe</program>
                    <programArguments>--defaults-file=${installdir.dos}\mysql\my.ini &amp;</programArguments>
                    <workingDirectory></workingDirectory>
                </runProgram>
                <wait>
                    <ms>8000</ms>
                </wait>
                <runProgram>
                    <program>${installdir}/bin/runctl.bat</program>
                    <programArguments>apache start &amp;</programArguments>
                    <progressText>Starting Apache</progressText>
                </runProgram>
                <wait>
                    <ms>12000</ms>
                    <progressText>Starting configuration process</progressText>
                </wait>
                
                <httpGet>
                    <url>http://127.0.0.1:${web_server_port}/sugarcrm/install.php?goto=SilentInstall&amp;cli=true</url>
                    <filename>${installdir}/silent.log</filename>
                    <progressText>Initializing database, this may take a few minutes.</progressText>
                    <abortOnError>0</abortOnError>
                </httpGet>
                <runProgram>
                    <program>${installdir}/bin/runctl.bat</program>
                    <programArguments>apache stop</programArguments>
                </runProgram>
                <wait>
                    <ms>12000</ms>
                </wait>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <progressText>Shutting down MySQL</progressText>
                    <program>${installdir}\mysql\bin\mysqladmin.exe</program>
                    <programArguments>--defaults-file=${installdir.dos}\mysql\my.ini shutdown</programArguments>
                </runProgram>
                <runProgram>
                    <progressText>Installing Services</progressText>
                    <program>${installdir}/bin/serviceinstall.bat</program>
                    <programArguments>INSTALL</programArguments>
                    <runAs></runAs>
                    <workingDirectory></workingDirectory>
                    <ruleList>
                        <compareText text="${installAsService}" logic="equals" value="1" />
                    </ruleList>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest type="windows" />
            </ruleList>
        </actionGroup>
	<actionGroup>
	  <actionList>
	    <addUnixService>
              <name>sugarcrm</name>
              <description>sugarcrm service</description>
              <program>${installdir}/common/scripts/sugarcrm</program>
              <abortOnError>0</abortOnError>
	           <ruleEvaluationLogic>or</ruleEvaluationLogic>
              <ruleList>
                <platformTest type="linux" />			
              </ruleList>			
	    </addUnixService>
	  </actionList>
	  <ruleList>
                <compareText text="${installAsService}" logic="equals" value="1" />
	  </ruleList>
	</actionGroup>
		
		<!--Service installation OSX -->
		<actionGroup>
			<actionList>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' | sudo -S mkdir /Library/StartupItems</programArguments>
				</runProgram>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' | sudo -S chgrp wheel /Library/StartupItems</programArguments>
				</runProgram>
			</actionList>
			<ruleEvaluationLogic>and</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="osx" />		
				<fileTest path="/Library/StartupItems" condition="not_exists" />
				<compareText text="${installAsService}" logic="equals" value="1" />
				<!--<compareText text="${installer_root_install}" logic="equals" value="1" />-->
				<compareText text="${sudopass_valid}" logic="equals" value="1" />
			</ruleList>
		</actionGroup>
		
		<actionGroup>
			<actionList>
				<setInstallerVariable>
					<name>service</name>
					<value>Sugarcrm</value>
				</setInstallerVariable>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' | sudo -S rm -rf /Library/StartupItems/${service}</programArguments>
				</runProgram>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' | sudo -S mkdir /Library/StartupItems/${service}</programArguments>
				</runProgram>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' | sudo -S mv ${installdir}/tmp/Sugarcrm /Library/StartupItems/${service}/${service}</programArguments>
				</runProgram>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' |  sudo -S mv ${installdir}/tmp/StartupParameters.plist /Library/StartupItems/${service}/StartupParameters.plist</programArguments>
                </runProgram>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' |  sudo -S chmod 755 /Library/StartupItems/${service}/${service}</programArguments>
				</runProgram>
				<runProgram>
					<program>echo</program>
					<programArguments>'${sudopass}' |  sudo -S chown root:wheel /Library/StartupItems/${service}/${service} /Library/StartupItems/${service}/StartupParameters.plist</programArguments>
				</runProgram>
			</actionList>
			<ruleEvaluationLogic>and</ruleEvaluationLogic>
			<ruleList>
				<platformTest type="osx" />
				<compareText text="${installAsService}" logic="equals" value="1" />
				<!--<compareText text="${installer_root_install}" logic="equals" value="1" />-->
				<compareText text="${sudopass_valid}" logic="equals" value="1" />
			</ruleList>
		</actionGroup>
  		
		
		<deleteFile path="${installdir}/tmp/">
			<ruleList>
				<platformTest type="osx" />
			</ruleList>
		</deleteFile>

		<!--Set sugarcrm start in the computer init. Root only on Solaris.-->
		<actionGroup>
			<actionList>
		       
				<copyFile>
					<origin>${installdir}/sugarctl.sh</origin>
					<destination>/etc/init.d/sugarcrm</destination>
				</copyFile>	
				
				<createSymLink>
					<target>../init.d/sugarcrm</target>
					<linkName>/etc/rc0.d/K99sugarcrm</linkName>
				</createSymLink>
			
				<createSymLink>
					<target>../init.d/sugarcrm</target>
					<linkName>/etc/rc1.d/K99sugarcrm</linkName>
				</createSymLink>
			
				<createSymLink>
					<target>../init.d/sugarcrm</target>
					<linkName>/etc/rc2.d/S99sugarcrm</linkName>
				</createSymLink>
			
				<createSymLink>
					<target>../init.d/sugarcrm</target>
					<linkName>/etc/rc3.d/S99sugarcrm</linkName>
				</createSymLink>
			</actionList>
			<ruleEvaluationLogic>and</ruleEvaluationLogic>
			<ruleList>
				<compareText text="${installAsService}" logic="equals" value="1" />
				<compareText logic="equals" text="${installer_root_install}" value="1" />	   				
				<platformTest type="solaris" />
			</ruleList>
		</actionGroup>
    </postInstallationActionList>  


    <preUninstallationActionList>
        <showQuestion variable="remove_mysql" text="Do you want the uninstallation to also remove the SugarCRM database data?" />
        <actionGroup>
            <actionList>
                <runProgram>
                    <program>${installdir}/sugarctl.sh</program>
                    <programArguments>stop apache</programArguments>
                </runProgram>
                <wait>
                    <ms>3000</ms>
                </wait>
                <runProgram>
                    <program>${installdir}/sugarctl.sh</program>
                    <programArguments>stop mysql</programArguments>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest type="unix" />
            </ruleList>
        </actionGroup>
        
        <actionGroup>
            <actionList>
                <runProgram>
                    <progressText>Waiting for Services to stop, please be patient</progressText>		
                    <program>${installdir}/bin/allctl.bat</program>
                    <programArguments>stop</programArguments>
                    <workingDirectory>${installdir}/bin</workingDirectory>
                </runProgram>
                <runProgram>
                    <program>${installdir}/bin/servicerun.bat</program>
                    <programArguments>stop</programArguments>
                </runProgram>
                <wait>
                    <progressText>Waiting for Services to stop, please be patient</progressText>
                    <ms>8000</ms>
                </wait>
                <runProgram>
                    <program>${installdir}/bin/serviceinstall.bat</program>
                    <programArguments>REMOVE</programArguments>
                </runProgram>
                <wait>
                    <progressText>Removing services</progressText>
                    <ms>5000</ms>
                </wait>				
            </actionList>
            <ruleList>
                <platformTest type="windows" />
            </ruleList>
        </actionGroup>

	<actionGroup>
	  <actionList>
            <deleteFile>
	      <abortOnError>0</abortOnError>
	      <showMessageOnError>0</showMessageOnError>
              <path>/etc/init.d/sugarcrm</path>
            </deleteFile>
            <deleteFile>
	      <abortOnError>0</abortOnError>
	      <showMessageOnError>0</showMessageOnError>
              <path>/etc/rc0.d/K99sugarcrm</path>
            </deleteFile>
            <deleteFile>
	      <abortOnError>0</abortOnError>
	      <showMessageOnError>0</showMessageOnError>
              <path>/etc/rc1.d/K99sugarcrm</path>
            </deleteFile>
            <deleteFile>
	      <abortOnError>0</abortOnError>
	      <showMessageOnError>0</showMessageOnError>
              <path>/etc/rc2.d/S99sugarcrm</path>
            </deleteFile>
            <deleteFile>
	      <abortOnError>0</abortOnError>
	      <showMessageOnError>0</showMessageOnError>
              <path>/etc/rc3.d/S99sugarcrm</path>
            </deleteFile>
	  </actionList>
	  <ruleList>
	    <compareText text="${installAsService}" logic="equals" value="1" />
	    <compareText logic="equals" text="${installer_root_install}" value="1" />	   				
	    <platformTest type="solaris" />
	  </ruleList>
	</actionGroup>
    </preUninstallationActionList>
    


	<postUninstallationActionList>
        <deleteFile path="${installdir}/silent.log" />    
        <deleteFile path="${installdir}/php" />	    
		<deleteFile path="${installdir}/htdocs" />	    	
        <deleteFile path="${installdir}/mysql/bin" />
        <deleteFile path="${installdir}/install_summary.txt" />
        <deleteFile>
            <path>${installdir}/mysql</path>
            <ruleList>
                <compareText text="${remove_mysql}" logic="equals" value="yes" />
            </ruleList>
        </deleteFile>
        <deleteFile path="${installdir}/apache2" />
    </postUninstallationActionList>    

    
    <finalPageActionList>
        <actionGroup progressText="Launch SugarCRM now?" >
            <actionList>
                <runProgram>
                    <program>${installdir}/bin/allctl.bat</program>
                    <programArguments>start &amp;</programArguments>
                    <ruleEvaluationLogic>and</ruleEvaluationLogic>		    
                    <ruleList>
                        <compareText text="${installAsService}" logic="does_not_equal" value="1" />
                        <platformTest type="windows" />			
                    </ruleList>
                </runProgram>
                <runProgram>
                    <program>${installdir}/bin/servicerun.bat</program>
                    <programArguments>START &amp;</programArguments>
                    <ruleEvaluationLogic>and</ruleEvaluationLogic>
                    <ruleList>
                        <compareText text="${installAsService}" logic="equals" value="1" />
                        <platformTest type="windows" />
                    </ruleList>
                </runProgram>
                <wait>
                    <ms>2000</ms>
                </wait>
                <setEnvironmentVariable name="DYLD_LIBRARY_PATH" value="" />
                <launchBrowser url="http://127.0.0.1:${web_server_port}/sugarcrm" />
            </actionList>
            <ruleList>
                <compareText text="${installer_ui}" logic="equals" value="gui" />
            </ruleList>
        </actionGroup>
    </finalPageActionList> 
</project>
